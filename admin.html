<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - SIV Resources Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Mobile menu toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle navigation menu">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Side Navigation -->
    <nav class="side-nav" id="sideNav">
        <div class="nav-header">
            <h2>SIV Admin Portal</h2>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="index.html" class="nav-link">
                    <span class="nav-icon">üìä</span>
                    SIV Issuances
                </a>
            </li>
            <li class="nav-item">
                <a href="visa-information.html" class="nav-link">
                    <span class="nav-icon">üìã</span>
                    Visa Information
                </a>
            </li>
            <li class="nav-item">
                <a href="travel-information.html" class="nav-link">
                    <span class="nav-icon">‚úàÔ∏è</span>
                    Travel Information
                </a>
            </li>
            <li class="nav-item active">
                <a href="admin.html" class="nav-link">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    Admin Portal
                </a>
            </li>
            <li class="nav-item">
                <a href="database.html" class="nav-link">
                    <span class="nav-icon">üóÑÔ∏è</span>
                    Database View
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="admin-container">
            <!-- Admin Header -->
            <header class="admin-header">
                <div class="header-content">
                    <div class="header-title">
                        <h1>Country Information Management</h1>
                        <p class="header-subtitle">Update visa requirements and travel information for SIV applicants</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-ai-primary" id="aiDataBtn" title="Use AI to automatically fetch country information">
                            <span class="btn-icon">ü§ñ</span>
                            <span class="btn-text">AI Auto-Fill Data</span>
                            <span class="btn-badge">NEW</span>
                        </button>
                        <button class="btn btn-primary" id="dataImportBtn">
                            <span class="btn-icon">üì§</span>
                            SIV Data Upload
                        </button>
                    </div>
                </div>
            </header>

            <!-- Floating Action Buttons -->
            <div class="floating-actions" id="floatingActions" style="display: none;">
                <button class="floating-btn discard" id="floatingDiscardBtn" title="Discard Changes">
                    <span class="floating-icon">‚Ü©Ô∏è</span>
                    <span class="floating-text">Discard</span>
                </button>
                <button class="floating-btn save" id="floatingSaveBtn" title="Save Changes">
                    <span class="floating-icon">üíæ</span>
                    <span class="floating-text">Save</span>
                </button>
            </div>

            <!-- Search Section -->
            <section class="search-section">
                <div class="search-container">
                    <div class="search-wrapper">
                        <input type="text" id="countrySearch" class="admin-search-input" placeholder="Search for a country...">
                        <span class="search-icon">üîç</span>
                    </div>
                    <div class="search-results" id="searchResults" style="display: none;">
                        <!-- Search results will appear here -->
                    </div>
                </div>
                
                <!-- Quick AI Actions -->
                <div class="quick-ai-actions">
                    <button class="btn-ai-quick" id="quickAIBtn">
                        <span class="ai-sparkle">‚ú®</span>
                        <span>Quick AI Fill: Select a country above, then click here to auto-populate all fields with AI</span>
                    </button>
                </div>
            </section>

            <!-- Excel Import Section -->
            <section class="import-section" id="importSection" style="display: none;">
                <div class="import-container">
                    <div class="import-header">
                        <h2>üì§ SIV Data Upload</h2>
                        <p class="import-subtitle">Upload Excel files to automatically update SIV issuances data</p>
                        <button class="btn btn-secondary btn-sm close-import-btn" id="closeImportBtn">
                            <span class="btn-icon">√ó</span>
                            Close Data Upload
                        </button>
                    </div>
                    
                    <div class="import-card">
                        <div class="import-card-header">
                            <span class="import-icon">üìà</span>
                            <div>
                                <h3>SIV Issuances Data</h3>
                                <p>Upload monthly embassy processing reports</p>
                            </div>
                        </div>
                        <div class="import-card-body">
                            <div class="file-upload-area" id="sivUploadArea">
                                <input type="file" id="sivFileInput" accept=".xlsx,.xls" multiple hidden>
                                <div class="upload-content">
                                    <span class="upload-icon">üìÅ</span>
                                    <p class="upload-text">Drop Excel files here or <span class="upload-link">browse files</span></p>
                                    <p class="upload-hint">Supports .xlsx and .xls formats ‚Ä¢ Select multiple files</p>
                                </div>
                            </div>
                            <div id="selectedFiles" class="selected-files" style="display: none;"></div>
                            <div class="import-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="sivReplaceData" checked>
                                    Replace existing data for matching months
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="sivValidateData" checked>
                                    Validate data before import
                                </label>
                            </div>
                            <div class="import-actions">
                                <button class="btn btn-secondary" id="sivPreviewBtn" disabled>
                                    <span class="btn-icon">üëÅÔ∏è</span>
                                    Preview Data
                                </button>
                                <button class="btn btn-primary" id="sivImportBtn" disabled>
                                    <span class="btn-icon">‚¨ÜÔ∏è</span>
                                    Import Data
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Import Progress -->
                    <div class="import-progress" id="importProgress" style="display: none;">
                        <div class="progress-header">
                            <h3>Import Progress</h3>
                            <button class="btn btn-secondary btn-sm" id="cancelImportBtn">Cancel</button>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-status" id="progressStatus">Processing file...</div>
                        <div class="progress-log" id="progressLog"></div>
                    </div>
                    
                    <!-- Recent Imports -->
                    <div class="recent-imports">
                        <h3>Recent Imports</h3>
                        <div class="imports-table">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>File Name</th>
                                        <th>Status</th>
                                        <th>Records</th>
                                        <th>Date</th>
                                        <th>User</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="importsTableBody">
                                    <!-- Recent imports will appear here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI Data Fetching Section -->
            <section class="ai-fetch-section" id="aiFetchSection" style="display: none;">
                <div class="ai-fetch-container">
                    <div class="ai-fetch-header">
                        <h2>ü§ñ AI-Powered Data Collection</h2>
                        <p class="ai-fetch-subtitle">Use AI to automatically fetch comprehensive country information</p>
                        <button class="btn btn-secondary btn-sm close-ai-btn" id="closeAIBtn">
                            <span class="btn-icon">√ó</span>
                            Close AI Assistant
                        </button>
                    </div>
                    
                    <div class="ai-config-card">
                        <h3>Configuration</h3>
                        <div class="form-group">
                            <label for="openaiApiKey">OpenAI API Key</label>
                            <input type="password" id="openaiApiKey" class="form-control" placeholder="sk-...">
                            <small>Your API key is stored locally and never sent to our servers</small>
                        </div>
                    </div>
                    
                    <div class="ai-fetch-card">
                        <h3>Select Countries to Research</h3>
                        <div class="country-selection-grid" id="aiCountrySelection">
                            <!-- Countries will be populated here -->
                        </div>
                        
                        <h3>Select Information Categories</h3>
                        <div class="category-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" name="ai-category" value="visaPolicy" checked>
                                Visa Policy
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="ai-category" value="workRights" checked>
                                Work Rights
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="ai-category" value="usEmbassy" checked>
                                U.S. Embassy & Medical
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="ai-category" value="safety" checked>
                                Safety & Neighborhoods
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="ai-category" value="accommodation" checked>
                                Accommodation
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="ai-category" value="costOfLiving" checked>
                                Cost of Living
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="ai-category" value="travelRoutes" checked>
                                Travel Routes
                            </label>
                        </div>
                        
                        <div class="ai-fetch-actions">
                            <button class="btn btn-primary" id="startAIFetch">
                                <span class="btn-icon">üîç</span>
                                Fetch Data with AI
                            </button>
                        </div>
                    </div>
                    
                    <!-- AI Results Preview -->
                    <div class="ai-results" id="aiResults" style="display: none;">
                        <h3>AI-Generated Data Preview</h3>
                        <div class="ai-results-content" id="aiResultsContent">
                            <!-- Results will appear here -->
                        </div>
                        <div class="ai-results-actions">
                            <button class="btn btn-secondary" id="rejectAIData">
                                <span class="btn-icon">‚ùå</span>
                                Discard All
                            </button>
                            <button class="btn btn-primary" id="acceptAIData">
                                <span class="btn-icon">‚úÖ</span>
                                Accept & Import to Database
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Country Editor Section -->
            <section class="editor-section" id="editorSection" style="display: none;">
                <div class="editor-header">
                    <div class="country-info">
                        <span class="country-flag" id="countryFlag">üè≥Ô∏è</span>
                        <div>
                            <h2 class="country-name" id="countryName">Select a Country</h2>
                            <p class="embassy-info" id="embassyInfo">Location information will appear here</p>
                        </div>
                    </div>
                    <button class="btn-ai-fill" id="aiAutoFillBtn" title="Use AI to fill all fields for this country">
                        <span class="ai-icon">ü§ñ</span>
                        <span>AI Auto-Fill This Country</span>
                    </button>
                    <div class="editor-tabs">
                        <button class="tab-btn active" data-tab="visa">Visa Policy</button>
                        <button class="tab-btn" data-tab="work">Work Rights</button>
                        <button class="tab-btn" data-tab="embassy">U.S. Embassy</button>
                        <button class="tab-btn" data-tab="safety">Safety</button>
                        <button class="tab-btn" data-tab="accommodation">Accommodation</button>
                        <button class="tab-btn" data-tab="cost">Cost of Living</button>
                        <button class="tab-btn" data-tab="travel">Travel Routes</button>
                        <button class="tab-btn" data-tab="history">History</button>
                    </div>
                </div>

                <!-- Visa Policy Tab -->
                <div class="tab-content active" id="visaTab">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3 class="section-title">Visa Policy</h3>
                            <div class="form-group">
                                <label for="visaCategory">Visa Category</label>
                                <select id="visaCategory" class="form-control">
                                    <option value="">-- Select --</option>
                                    <option value="visa-free">Visa-free</option>
                                    <option value="visa-on-arrival">Visa on Arrival</option>
                                    <option value="e-visa">E-visa</option>
                                    <option value="embassy-visa">Embassy Visa</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="entryMode">Entry Mode</label>
                                <input type="text" id="entryMode" class="form-control" placeholder="e.g., land, air, sea">
                            </div>
                            <div class="form-group">
                                <label for="visaFeeSingleUsd">Single Entry Visa Fee (USD)</label>
                                <input type="number" id="visaFeeSingleUsd" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="visaFeeMultipleUsd">Multiple Entry Visa Fee (USD)</label>
                                <input type="number" id="visaFeeMultipleUsd" class="form-control" placeholder="0">
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">Visa Extension</h3>
                            <div class="form-group">
                                <label for="visaExtensionAllowed">Extension Allowed</label>
                                <select id="visaExtensionAllowed" class="form-control">
                                    <option value="">-- Select --</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="visaExtensionMaxDays">Maximum Extension Days</label>
                                <input type="number" id="visaExtensionMaxDays" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="visaExtensionFeeUsd">Extension Fee (USD)</label>
                                <input type="number" id="visaExtensionFeeUsd" class="form-control" placeholder="0">
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">Work & Application</h3>
                            <div class="form-group">
                                <label for="workAllowedOnVisa">Work Allowed on Visa</label>
                                <select id="workAllowedOnVisa" class="form-control">
                                    <option value="">-- Select --</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="visaApplicationMethod">Application Method</label>
                                <input type="text" id="visaApplicationMethod" class="form-control" placeholder="online, embassy, on-arrival">
                            </div>
                            <div class="form-group">
                                <label for="visaApplicationUrl">Application URL</label>
                                <input type="url" id="visaApplicationUrl" class="form-control" placeholder="https://visa.example.gov">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Work Rights Tab -->
                <div class="tab-content" id="workTab">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3 class="section-title">Work Rights & Short-Term Work</h3>
                            <div class="form-group">
                                <label for="canWorkLegallyOnArrival">Can Work Legally on Arrival</label>
                                <select id="canWorkLegallyOnArrival" class="form-control">
                                    <option value="">-- Select --</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="conditionsToWork">Conditions to Work</label>
                                <textarea id="conditionsToWork" class="form-control" rows="3" placeholder="Describe requirements and conditions for legal work"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="shortTermWorkInfo">Short-Term Work Info</label>
                                <textarea id="shortTermWorkInfo" class="form-control" rows="3" placeholder="Information about short-term work opportunities"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- U.S. Embassy Tab -->
                <div class="tab-content" id="embassyTab">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3 class="section-title">U.S. Embassy & Consulate</h3>
                            <div class="form-group">
                                <label for="usEmbassyName">U.S. Embassy Name</label>
                                <input type="text" id="usEmbassyName" class="form-control" placeholder="Full name of U.S. Embassy or Consulate">
                            </div>
                            <div class="form-group">
                                <label for="usEmbassyAddress">Embassy Address</label>
                                <textarea id="usEmbassyAddress" class="form-control" rows="2" placeholder="Complete address of U.S. Embassy"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="usEmbassyWebsiteUrl">Embassy Website URL</label>
                                <input type="url" id="usEmbassyWebsiteUrl" class="form-control" placeholder="https://embassy.example.gov">
                            </div>
                            <div class="form-group">
                                <label for="usEmbassyIvUrl">Immigrant Visa URL</label>
                                <input type="url" id="usEmbassyIvUrl" class="form-control" placeholder="https://embassy.example.gov/iv">
                            </div>
                            <div class="form-group">
                                <label for="usEmbassyIvEmail">Immigrant Visa Email</label>
                                <input type="email" id="usEmbassyIvEmail" class="form-control" placeholder="iv@embassy.example.gov">
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">Medical Exam Facility</h3>
                            <div class="form-group">
                                <label for="medicalExamFacilityName">Medical Facility Name</label>
                                <input type="text" id="medicalExamFacilityName" class="form-control" placeholder="Name of approved medical exam facility">
                            </div>
                            <div class="form-group">
                                <label for="medicalExamFacilityAddress">Facility Address</label>
                                <textarea id="medicalExamFacilityAddress" class="form-control" rows="2" placeholder="Address of medical exam facility"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="medicalExamFacilityPhone">Facility Phone</label>
                                <input type="tel" id="medicalExamFacilityPhone" class="form-control" placeholder="+1-234-567-8900">
                            </div>
                            <div class="form-group">
                                <label for="medicalExamFacilityWebsite">Facility Website</label>
                                <input type="url" id="medicalExamFacilityWebsite" class="form-control" placeholder="https://medical.example.com">
                            </div>
                            <div class="form-group">
                                <label for="medicalExamNotes">Medical Exam Notes</label>
                                <textarea id="medicalExamNotes" class="form-control" rows="3" placeholder="Important notes about medical exams"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Safety Tab -->
                <div class="tab-content" id="safetyTab">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3 class="section-title">Safety & Neighborhoods</h3>
                            <div class="form-group">
                                <label for="travelAdvisoryLevel">Travel Advisory Level</label>
                                <select id="travelAdvisoryLevel" class="form-control">
                                    <option value="">-- Select --</option>
                                    <option value="1">Level 1 - Exercise Normal Precautions</option>
                                    <option value="2">Level 2 - Exercise Increased Caution</option>
                                    <option value="3">Level 3 - Reconsider Travel</option>
                                    <option value="4">Level 4 - Do Not Travel</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="travelAdvisoryUrl">Travel Advisory URL</label>
                                <input type="url" id="travelAdvisoryUrl" class="form-control" placeholder="https://travel.state.gov/content/travel/en/traveladvisories">
                            </div>
                            <div class="form-group">
                                <label for="hotspotNotes">Areas to Avoid</label>
                                <textarea id="hotspotNotes" class="form-control" rows="3" placeholder="Notes about areas to avoid or be cautious"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="saferNeighborhoods">Safer Neighborhoods</label>
                                <textarea id="saferNeighborhoods" class="form-control" rows="3" placeholder="List of safer neighborhoods for visitors"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="afghanNeighborhoods">Afghan Communities</label>
                                <textarea id="afghanNeighborhoods" class="form-control" rows="3" placeholder="Areas with Afghan communities"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accommodation Tab -->
                <div class="tab-content" id="accommodationTab">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3 class="section-title">Accommodation Pricing (USD)</h3>
                            <div class="form-group">
                                <label for="hostelPriceMinUsd">Hostel Price Min (per night)</label>
                                <input type="number" id="hostelPriceMinUsd" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="hostelPriceMaxUsd">Hostel Price Max (per night)</label>
                                <input type="number" id="hostelPriceMaxUsd" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="budgetHotelPriceMinUsd">Budget Hotel Price Min (per night)</label>
                                <input type="number" id="budgetHotelPriceMinUsd" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="budgetHotelPriceMaxUsd">Budget Hotel Price Max (per night)</label>
                                <input type="number" id="budgetHotelPriceMaxUsd" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="furnishedRentalPriceMinUsd">Furnished Rental Min (per month)</label>
                                <input type="number" id="furnishedRentalPriceMinUsd" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="furnishedRentalPriceMaxUsd">Furnished Rental Max (per month)</label>
                                <input type="number" id="furnishedRentalPriceMaxUsd" class="form-control" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost of Living Tab -->
                <div class="tab-content" id="costTab">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3 class="section-title">Cost of Living (USD per month)</h3>
                            <div class="form-group">
                                <label for="costSinglePersonUsd">Single Person Cost</label>
                                <input type="number" id="costSinglePersonUsd" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="costFamily4Usd">Family of 4 Cost</label>
                                <input type="number" id="costFamily4Usd" class="form-control" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Travel Routes Tab -->
                <div class="tab-content" id="travelTab">
                    <div class="form-grid">
                        <div class="form-section">
                            <h3 class="section-title">Travel Routes & Flights</h3>
                            <div class="form-group">
                                <label for="originAirportCode">Origin Airport Code</label>
                                <input type="text" id="originAirportCode" class="form-control" placeholder="e.g., KBL, ISB">
                            </div>
                            <div class="form-group">
                                <label for="destinationAirportCode">Destination Airport Code</label>
                                <input type="text" id="destinationAirportCode" class="form-control" placeholder="e.g., JFK, LHR">
                            </div>
                            <div class="form-group">
                                <label for="transitPoints">Transit Points</label>
                                <input type="text" id="transitPoints" class="form-control" placeholder="e.g., Dubai, Istanbul">
                            </div>
                            <div class="form-group">
                                <label for="transitVisaNotes">Transit Visa Notes</label>
                                <textarea id="transitVisaNotes" class="form-control" rows="2" placeholder="Notes about transit visa requirements"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="flightPriceOnewayUsd">One-way Flight Price (USD)</label>
                                <input type="number" id="flightPriceOnewayUsd" class="form-control" placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="flightSearchUrl">Flight Search URL</label>
                                <input type="url" id="flightSearchUrl" class="form-control" placeholder="https://kayak.com or recommended booking site">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Change History Tab -->
                <div class="tab-content" id="historyTab">
                    <div class="history-container">
                        <div class="history-header">
                            <h3 class="section-title">Recent Changes</h3>
                            <span class="history-count">Showing last 10 changes</span>
                        </div>
                        <div class="history-list" id="historyList">
                            <!-- Change history will appear here -->
                        </div>
                    </div>
                </div>

            </section>
        </div>
    </main>

    <!-- Notification Toast -->
    <div class="notification-toast" id="notificationToast">
        <span class="notification-icon">‚úì</span>
        <span class="notification-message">Changes saved successfully!</span>
    </div>

    <script src="ai-data-fetcher.js"></script>
    <script src="admin.js"></script>
</body>
</html>